const app = getApp(); Page({ data: { listData: [], page: 1, loading: false, isEnd: false }, onLoad() { this.loadData(); }, onPullDownRefresh() { this.setData({ page: 1, isEnd: false, listData: [] }); this.loadData().then(() => { wx.stopPullDownRefresh(); }); }, onReachBottom() { if (!this.data.isEnd && !this.data.loading) { this.loadMore(); } }, loadData() { this.setData({ loading: true }); return new Promise((resolve) => { app.util.request({ url: 'about/list', data: { page: this.data.page, size: 10 }, success: (res) => { if (res.code === 0) { this.setData({ listData: res.data.list || [], isEnd: !res.data.list || res.data.list.length < 10 }); } }, complete: () => { this.setData({ loading: false }); resolve(); } }); }); }, loadMore() { if (this.data.loading || this.data.isEnd) return; this.setData({ page: this.data.page + 1, loading: true }); app.util.request({ url: 'about/list', data: { page: this.data.page, size: 10 }, success: (res) => { if (res.code === 0 && res.data.list && res.data.list.length > 0) { this.setData({ listData: [...this.data.listData, ...res.data.list], isEnd: res.data.list.length < 10 }); } else { this.setData({ isEnd: true }); } }, complete: () => { this.setData({ loading: false }); } }); }, goDetail(e) { const id = e.currentTarget.dataset.id; wx.navigateTo({ url: '/pages/aboutus/detail?id=' + id }); } });